resources:
- name: discord-bot
  type: git
  source:
    uri: https://((github_apikey))@github.com/cluedtke/discord-bot-drink-water.git
    branch: main

jobs:
- name: deploy-bot
  plan:
  - get: discord-bot
    trigger: true
  - task: deploy
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: { repository: node, tag: '16' }
      params:
        DISCORD_BOT_TOKEN: ((discord_bot_token))
      inputs:
      - name: discord-bot
      run:
        path: /bin/sh
        args:
        - -exc
        - |
          cd discord-bot
          npm cache clean --force
          npm install
          node bot.js
    ensure:
      put: discord-bot
      params: { repository: discord-bot }
